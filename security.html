

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Security &mdash; Riak Python Client 2.7.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Riak Python Client 2.7.0 documentation" href="index.html"/>
        <link rel="next" title="Advanced Usage &amp; Internals" href="advanced.html"/>
        <link rel="prev" title="Query Methods" href="query.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Riak Python Client
          

          
          </a>

          
            
            
              <div class="version">
                2.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="client.html">Client &amp; Connections</a></li>
<li class="toctree-l1"><a class="reference internal" href="bucket.html">Buckets &amp; Bucket Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="object.html">Values &amp; Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="datatypes.html">Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="query.html">Query Methods</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Security</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#server-configuration">Server Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#client-configuration">Client Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#authentication-types">Authentication Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#trust-and-pam-authentication">Trust and PAM Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="#password-authentication">Password Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="#client-certificate-authentication">Client Certificate Authentication</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#additional-options">Additional options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#certificate-revocation-lists">Certificate revocation lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cipher-options">Cipher options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#securitycreds-object">SecurityCreds object</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced Usage &amp; Internals</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Riak Python Client</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Security</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/security.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="security">
<span id="security-label"></span><h1>Security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h1>
<p>Riak 2.0 supports authentication and authorization over encrypted
channels via OpenSSL. This is useful to prevent accidental collisions
between environments (e.g., pointing application software under active
development at the production cluster) and offers protection against
some malicious attacks, although Riak still should not be exposed
directly to any unsecured network.</p>
<p>Several important caveats when enabling security:</p>
<ul class="simple">
<li>There is no support yet for auditing. This is on the roadmap for a future
release.</li>
<li>Two deprecated features will not work if security is enabled: link
walking and Riak Search 1.0.</li>
<li>There are restrictions on Erlang modules exposed to MapReduce jobs when
security is enabled.</li>
<li>Enabling security requires applications be designed to transition
gracefully based on the server response or applications will need to be
halted before security is enabled and brought back online with support
for the new security features.</li>
</ul>
<div class="section" id="server-configuration">
<h2>Server Configuration<a class="headerlink" href="#server-configuration" title="Permalink to this headline">¶</a></h2>
<p>The server must first be configured to <a class="reference external" href="http://docs.basho.com/riak/2.0.0/ops/running/authz/#Security-Basics">enable security</a>,
users and <a class="reference external" href="http://docs.basho.com/riak/2.0.0/ops/running/security-sources/">security sources</a>
must be created, <a class="reference external" href="http://docs.basho.com/riak/2.0.0/ops/running/authz/#Managing-Permissions">permissions</a>
applied and the correct certificates must be installed.  An overview
can be found at <a class="reference external" href="http://docs.basho.com/riak/2.0.0/ops/running/authz/">Authentication and Authorization</a>.</p>
</div>
<div class="section" id="client-configuration">
<h2>Client Configuration<a class="headerlink" href="#client-configuration" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">OpenSSL 1.0.1g or later (or patched version built after
2014-04-01) is required for <a class="reference external" href="http://pypi.python.org/pypi/pyOpenSSL/">pyOpenSSL</a>, which is used
for secure transport in the Riak client. Earlier versions
may not support TLS 1.2, the recommended security protocol.</p>
</div>
<p>On the client, simply create a
<code class="xref py py-class docutils literal"><span class="pre">SecurityCreds</span></code> object with just a username,
password and CA Certificate file. That would then need to be passed
into the <code class="xref py py-class docutils literal"><span class="pre">RiakClient</span></code> initializer:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">creds</span> <span class="o">=</span> <span class="n">SecurityCreds</span><span class="p">(</span><span class="s1">&#39;riakuser&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;riakpass&#39;</span><span class="p">,</span>
                      <span class="n">cacert_file</span><span class="o">=</span><span class="s1">&#39;/path/to/ca.crt&#39;</span><span class="p">)</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">RiakClient</span><span class="p">(</span><span class="n">credentials</span><span class="o">=</span><span class="n">creds</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">credentials</span></code> argument of a <code class="xref py py-class docutils literal"><span class="pre">RiakClient</span></code> constructor
is a <code class="xref py py-class docutils literal"><span class="pre">SecurityCreds</span></code> object. If you specify a dictionary
instead, it will be turned into this type:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">creds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;riakuser&#39;</span><span class="p">,</span>
         <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;riakpass&#39;</span><span class="p">,</span>
         <span class="s1">&#39;cacert_file&#39;</span><span class="p">:</span> <span class="s1">&#39;/path/to/ca.crt&#39;</span><span class="p">}</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">RiakClient</span><span class="p">(</span><span class="n">credentials</span><span class="o">=</span><span class="n">creds</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A Certifying Authority (CA) Certificate must always be
supplied to <code class="xref py py-class docutils literal"><span class="pre">SecurityCreds</span></code> by specifying the path to
a CA certificate file via the <code class="docutils literal"><span class="pre">cacert_file</span></code> argument or by
setting the <code class="docutils literal"><span class="pre">cacert</span></code> argument to an <a class="reference external" href="http://pythonhosted.org/pyOpenSSL/api/crypto.html#x509-objects">OpenSSL.crypto.X509</a>
object. This mitigates MITM (man-in-the-middle) attacks by
ensuring correct certificate validation.</p>
</div>
</div>
<div class="section" id="authentication-types">
<h2>Authentication Types<a class="headerlink" href="#authentication-types" title="Permalink to this headline">¶</a></h2>
<div class="section" id="trust-and-pam-authentication">
<h3>Trust and PAM Authentication<a class="headerlink" href="#trust-and-pam-authentication" title="Permalink to this headline">¶</a></h3>
<p>The most basic authentication would be <a class="reference external" href="http://docs.basho.com/riak/2.0.0/ops/running/security-sources/#Trust-based-Authentication">Trust-based Authentication</a>
which is done exclusively on the server side by adding the appropriate
<code class="docutils literal"><span class="pre">trust</span></code> security source:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">riak</span><span class="o">-</span><span class="n">admin</span> <span class="n">security</span> <span class="n">add</span><span class="o">-</span><span class="n">source</span> <span class="nb">all</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="o">/</span><span class="mi">32</span> <span class="n">trust</span>
</pre></div>
</div>
<p><a class="reference external" href="http://docs.basho.com/riak/2.0.0/ops/running/security-sources/#PAM-based-Authentication">PAM-based Authentication</a>
is another server-side solution which can be added by a <code class="docutils literal"><span class="pre">pam</span></code>
security source with the name of the service:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">riak</span><span class="o">-</span><span class="n">admin</span> <span class="n">security</span> <span class="n">add</span><span class="o">-</span><span class="n">source</span> <span class="nb">all</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="o">/</span><span class="mi">32</span> <span class="n">pam</span> <span class="n">service</span><span class="o">=</span><span class="n">riak_pam</span>
</pre></div>
</div>
<p>Even if you are using Trust authentication or the PAM module doesn&#8217;t
require a password, you must supply one to the client API. From the
client&#8217;s perspective, these are equivalent to Password authentication.</p>
</div>
<div class="section" id="password-authentication">
<h3>Password Authentication<a class="headerlink" href="#password-authentication" title="Permalink to this headline">¶</a></h3>
<p>The next level of security would be simply a username and password for
<a class="reference external" href="http://docs.basho.com/riak/2.0.0/ops/running/security-sources/#Password-based-Authentication">Password-based Authentication</a>.
The server needs to first have a user and a <code class="docutils literal"><span class="pre">password</span></code> security source:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">riak</span><span class="o">-</span><span class="n">admin</span> <span class="n">security</span> <span class="n">add</span><span class="o">-</span><span class="n">user</span> <span class="n">riakuser</span> <span class="n">password</span><span class="o">=</span><span class="n">captheorem4life</span>
<span class="n">riak</span><span class="o">-</span><span class="n">admin</span> <span class="n">security</span> <span class="n">add</span><span class="o">-</span><span class="n">source</span> <span class="n">riakuser</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="o">/</span><span class="mi">32</span> <span class="n">password</span>
</pre></div>
</div>
<p>On the client, simply create a <code class="xref py py-class docutils literal"><span class="pre">SecurityCreds</span></code> object or dict
with just a username and password. That would then need to be passed
into the <code class="xref py py-class docutils literal"><span class="pre">RiakClient</span></code> initializer:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">creds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;riakuser&#39;</span><span class="p">,</span>
         <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;riakpass&#39;</span><span class="p">,</span>
         <span class="s1">&#39;cacert_file&#39;</span><span class="p">:</span> <span class="s1">&#39;/path/to/ca.crt&#39;</span><span class="p">}</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">RiakClient</span><span class="p">(</span><span class="n">credentials</span><span class="o">=</span><span class="n">creds</span><span class="p">)</span>
<span class="n">myBucket</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">bucket</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="n">val1</span> <span class="o">=</span> <span class="s2">&quot;#SeanCribbsHoldingThings&quot;</span>
<span class="n">key1</span> <span class="o">=</span> <span class="n">myBucket</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;hashtag&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">val1</span><span class="p">)</span>
<span class="n">key1</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="client-certificate-authentication">
<h3>Client Certificate Authentication<a class="headerlink" href="#client-certificate-authentication" title="Permalink to this headline">¶</a></h3>
<p>If you are using the <strong>Protocol Buffers</strong> transport you could also add
a layer of security by using <a class="reference external" href="http://docs.basho.com/riak/2.0.0/ops/running/security-sources/#Certificate-based-Authentication">Certificate-based Authentication</a>.
This time the server requires a <code class="docutils literal"><span class="pre">certificate</span></code> security source:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">riak</span><span class="o">-</span><span class="n">admin</span> <span class="n">security</span> <span class="n">add</span><span class="o">-</span><span class="n">source</span> <span class="n">riakuser</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="o">/</span><span class="mi">32</span> <span class="n">certificate</span>
</pre></div>
</div>
<p>When the <code class="docutils literal"><span class="pre">certificate</span></code> source is used, the Riak username must match
the common name, aka <code class="docutils literal"><span class="pre">CN</span></code>, that you specified when you generated your
certificate.  You can add a <code class="docutils literal"><span class="pre">certificate</span></code> source to any number of clients.</p>
<p>The <code class="xref py py-class docutils literal"><span class="pre">SecurityCreds</span></code> must then include the include a client
certificate file and a private key file, too:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">creds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;riakuser&#39;</span><span class="p">,</span>
         <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;riakpass&#39;</span><span class="p">,</span>
         <span class="s1">&#39;cacert_file&#39;</span><span class="p">:</span> <span class="s1">&#39;/path/to/ca.crt&#39;</span><span class="p">,</span>
         <span class="s1">&#39;cert_file&#39;</span><span class="p">:</span> <span class="s1">&#39;/path/to/client.crt&#39;</span><span class="p">,</span>
         <span class="s1">&#39;pkey_file&#39;</span><span class="p">:</span> <span class="s1">&#39;/path/to/client.key&#39;</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Username and password are still required for certificate-based
authentication, although the password is ignored.</p>
</div>
<p>Optionally, the certificate or private key may be supplied as a string:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/path/to/client.key&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">preloaded_pkey</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/path/to/client.crt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">preloaded_cert</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">creds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;riakuser&#39;</span><span class="p">,</span>
         <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;riakpass&#39;</span><span class="p">,</span>
         <span class="s1">&#39;cert&#39;</span><span class="p">:</span> <span class="n">preloaded_cert</span><span class="p">,</span>
         <span class="s1">&#39;pkey&#39;</span><span class="p">:</span> <span class="n">prelocated_pkey</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="additional-options">
<h2>Additional options<a class="headerlink" href="#additional-options" title="Permalink to this headline">¶</a></h2>
<div class="section" id="certificate-revocation-lists">
<h3>Certificate revocation lists<a class="headerlink" href="#certificate-revocation-lists" title="Permalink to this headline">¶</a></h3>
<p>Another security option available is a Certificate Revocation List (CRL).
It lists server certificates which, for whatever reason, are no longer
valid.  For example, it is discovered that the certificate authority (CA)
had improperly issued a certificate, or if a private-key is thought to
have been compromised.  The most common reason for revocation is the user
no longer being in sole possession of the private key (e.g., the token
containing the private key has been lost or stolen):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">creds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;riakuser&#39;</span><span class="p">,</span>
         <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;riakpass&#39;</span><span class="p">,</span>
         <span class="s1">&#39;cacert_file&#39;</span><span class="p">:</span> <span class="s1">&#39;/path/to/ca.crt&#39;</span><span class="p">,</span>
         <span class="s1">&#39;crl_file&#39;</span><span class="p">:</span> <span class="s1">&#39;/path/to/server.crl&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="cipher-options">
<h3>Cipher options<a class="headerlink" href="#cipher-options" title="Permalink to this headline">¶</a></h3>
<p>The last interesting setting on <code class="xref py py-class docutils literal"><span class="pre">SecurityCreds</span></code> is the
<code class="docutils literal"><span class="pre">ciphers</span></code> option which is a colon-delimited list of supported
ciphers for encryption:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">creds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;riakuser&#39;</span><span class="p">,</span>
         <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;riakpass&#39;</span><span class="p">,</span>
         <span class="s1">&#39;ciphers&#39;</span><span class="p">:</span> <span class="s1">&#39;ECDHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>A more detailed discussion can be found at <a class="reference external" href="http://docs.basho.com/riak/2.0.0/ops/running/authz/#Security-Ciphers">Security Ciphers</a>.</p>
</div>
</div>
<div class="section" id="securitycreds-object">
<h2>SecurityCreds object<a class="headerlink" href="#securitycreds-object" title="Permalink to this headline">¶</a></h2>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="advanced.html" class="btn btn-neutral float-right" title="Advanced Usage &amp; Internals" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="query.html" class="btn btn-neutral" title="Query Methods" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2010-2014, Basho Technologies.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.7.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
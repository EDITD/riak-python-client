

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Data Types &mdash; Riak Python Client 2.7.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Riak Python Client 2.7.0 documentation" href="index.html"/>
        <link rel="next" title="Query Methods" href="query.html"/>
        <link rel="prev" title="Values &amp; Objects" href="object.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Riak Python Client
          

          
          </a>

          
            
            
              <div class="version">
                2.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="client.html">Client &amp; Connections</a></li>
<li class="toctree-l1"><a class="reference internal" href="bucket.html">Buckets &amp; Bucket Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="object.html">Values &amp; Objects</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Data Types</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#sending-operations">Sending Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#context-and-observed-remove">Context and Observed-Remove</a></li>
<li class="toctree-l2"><a class="reference internal" href="#datatype-abstract-class">Datatype abstract class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#persistence-methods">Persistence methods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#counter">Counter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#set">Set</a></li>
<li class="toctree-l2"><a class="reference internal" href="#map">Map</a></li>
<li class="toctree-l2"><a class="reference internal" href="#map-only-datatypes">Map-only datatypes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#register">Register</a></li>
<li class="toctree-l2"><a class="reference internal" href="#flag">Flag</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="query.html">Query Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced Usage &amp; Internals</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Riak Python Client</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Data Types</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/datatypes.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="data-types">
<span id="datatypes"></span><h1>Data Types<a class="headerlink" href="#data-types" title="Permalink to this headline">¶</a></h1>
<p>Traditionally all data stored in Riak was an opaque binary type. Then
in version 1.4 came the introduction of a <a class="reference internal" href="client.html#legacy-counters"><span class="std std-ref">counter</span></a>, the first Convergent Data Type supported in Riak.
In Riak 2.0, several additional Data Types were introduced. Riak
&#8220;knows&#8221; about these data types, and conflicting writes to them will
converge automatically without presenting <a class="reference internal" href="object.html#siblings"><span class="std std-ref">sibling values</span></a> to the user.</p>
<p>Here is the list of current Data Types:</p>
<blockquote>
<div><ul class="simple">
<li><code class="xref py py-class docutils literal"><span class="pre">Counter</span></code> increments or decrements
integer values</li>
<li><code class="xref py py-class docutils literal"><span class="pre">Set</span></code> allows you to store multiple
distinct opaque binary values against a key</li>
<li><code class="xref py py-class docutils literal"><span class="pre">Map</span></code> is a nested, recursive
struct, or associative array. Think of it as a container for
composing ad hoc data structures from multiple Data Types.
Inside a map you may store sets, counters, flags,
registers, and even other maps</li>
<li><code class="xref py py-class docutils literal"><span class="pre">Register</span></code> stores binaries
accoring to last-write-wins logic within
<code class="xref py py-class docutils literal"><span class="pre">Map</span></code></li>
<li><code class="xref py py-class docutils literal"><span class="pre">Flag</span></code> is similar to a boolean
and also must be within <code class="xref py py-class docutils literal"><span class="pre">Map</span></code></li>
</ul>
</div></blockquote>
<p>All Data Types must be stored in buckets bearing a
<code class="xref py py-class docutils literal"><span class="pre">BucketType</span></code> that sets the
<a class="reference internal" href="bucket.html#riak.bucket.BucketType.datatype" title="riak.bucket.BucketType.datatype"><code class="xref py py-attr docutils literal"><span class="pre">datatype</span></code></a> property to one of
<code class="docutils literal"><span class="pre">&quot;counter&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;set&quot;</span></code>, or <code class="docutils literal"><span class="pre">&quot;map&quot;</span></code>. Note that the bucket must have
the <code class="docutils literal"><span class="pre">allow_mult</span></code> property set to <code class="docutils literal"><span class="pre">true</span></code>.</p>
<p>These Data Types are stored just like <code class="xref py py-class docutils literal"><span class="pre">RiakObjects</span></code>, so size constraints that apply to
normal Riak values apply to Riak Data Types too.</p>
<p>An in-depth discussion of Data Types, also known as CRDTs,
can be found at <a class="reference external" href="http://docs.basho.com/riak/2.0.0/theory/concepts/crdts/">Data Types</a>.</p>
<p>Examples of using Data Types can be found at
<a class="reference external" href="http://docs.basho.com/riak/2.0.0/dev/using/data-types/">Using Data Types</a>.</p>
<div class="section" id="sending-operations">
<h2>Sending Operations<a class="headerlink" href="#sending-operations" title="Permalink to this headline">¶</a></h2>
<p>Riak Data Types provide a further departure from Riak&#8217;s usual operation,
in that the API is operation-based. Rather than fetching the data structure,
reconciling conflicts, mutating the result, and writing it back, you instead
tell Riak what operations to perform on the Data Type. Here are some example
operations:</p>
<blockquote>
<div><ul class="simple">
<li>increment a <code class="xref py py-class docutils literal"><span class="pre">Counter</span></code> by <code class="docutils literal"><span class="pre">10</span></code></li>
<li>add <code class="docutils literal"><span class="pre">'joe'</span></code> to a <code class="xref py py-class docutils literal"><span class="pre">Set</span></code></li>
<li>remove the <code class="xref py py-class docutils literal"><span class="pre">Set</span></code> field called <code class="docutils literal"><span class="pre">'friends'</span></code> from a <code class="xref py py-class docutils literal"><span class="pre">Map</span></code></li>
<li>enable the prepay <code class="xref py py-class docutils literal"><span class="pre">Flag</span></code> in a <code class="xref py py-class docutils literal"><span class="pre">Map</span></code></li>
</ul>
</div></blockquote>
<p>Datatypes can be fetched and created just like
<code class="xref py py-class docutils literal"><span class="pre">RiakObject</span></code> instances, using
<code class="xref py py-meth docutils literal"><span class="pre">RiakBucket.get</span></code> and
<code class="xref py py-meth docutils literal"><span class="pre">RiakBucket.new</span></code>, except that the
bucket must belong to a bucket-type that has a valid datatype
property. If we have a bucket-type named &#8220;social-graph&#8221; that has the
datatype <cite>&#8220;set&#8221;</cite>, we would fetch a <code class="xref py py-class docutils literal"><span class="pre">Set</span></code> like so:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">bucket_type</span><span class="p">(</span><span class="s1">&#39;social-graph&#39;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">datatype</span>  <span class="c1"># =&gt; &#39;set&#39;</span>
<span class="n">myfollowers</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">bucket</span><span class="p">(</span><span class="s1">&#39;followers&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;seancribbs&#39;</span><span class="p">)</span>
<span class="c1"># =&gt; a Set datatype</span>
</pre></div>
</div>
<p>Once we have a datatype, we can stage operations against it and then
send those operations to Riak:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myfollowers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;javajolt&#39;</span><span class="p">)</span>
<span class="n">myfollowers</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s1">&#39;roach&#39;</span><span class="p">)</span>
<span class="n">myfollowers</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</pre></div>
</div>
<p>While this looks in code very similar to manipulating
<code class="xref py py-class docutils literal"><span class="pre">RiakObject</span></code> instances, only mutations are
enqueued locally, not the new value.</p>
</div>
<div class="section" id="context-and-observed-remove">
<h2>Context and Observed-Remove<a class="headerlink" href="#context-and-observed-remove" title="Permalink to this headline">¶</a></h2>
<p>In order for Riak Data Types to behave well, you must have an opaque
context received from a read when you:</p>
<blockquote>
<div><ul class="simple">
<li><code class="xref py py-meth docutils literal"><span class="pre">disable</span></code> a <code class="xref py py-class docutils literal"><span class="pre">Flag</span></code>
(set it to <code class="docutils literal"><span class="pre">false</span></code>)</li>
<li>remove a field from a <code class="xref py py-class docutils literal"><span class="pre">Map</span></code></li>
<li><code class="xref py py-meth docutils literal"><span class="pre">remove</span></code> an element from a <code class="xref py py-class docutils literal"><span class="pre">Set</span></code></li>
</ul>
</div></blockquote>
<p>The basic rule is &#8220;you cannot remove something you haven&#8217;t seen&#8221;, and
the context tells Riak what you&#8217;ve actually seen, similar to the
<a class="reference internal" href="object.html#vclock"><span class="std std-ref">Vector clock</span></a> on <code class="xref py py-class docutils literal"><span class="pre">RiakObject</span></code>. The Python
client handles opaque contexts for you transparently as long as you
fetch before performing one of these actions.</p>
</div>
<div class="section" id="datatype-abstract-class">
<h2>Datatype abstract class<a class="headerlink" href="#datatype-abstract-class" title="Permalink to this headline">¶</a></h2>
<div class="section" id="persistence-methods">
<h3>Persistence methods<a class="headerlink" href="#persistence-methods" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="riak.datatypes.Datatype.store">
<code class="descclassname">Datatype.</code><code class="descname">store</code><span class="sig-paren">(</span><em>**params</em><span class="sig-paren">)</span><a class="headerlink" href="#riak.datatypes.Datatype.store" title="Permalink to this definition">¶</a></dt>
<dd><p>This is an alias for <code class="xref py py-meth docutils literal"><span class="pre">update()</span></code>.</p>
</dd></dl>

</div>
</div>
<div class="section" id="counter">
<h2>Counter<a class="headerlink" href="#counter" title="Permalink to this headline">¶</a></h2>
<dl class="attribute">
<dt id="riak.datatypes.Counter.value">
<code class="descclassname">Counter.</code><code class="descname">value</code><a class="headerlink" href="#riak.datatypes.Counter.value" title="Permalink to this definition">¶</a></dt>
<dd><p>The current value of the counter.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">int</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="set">
<h2>Set<a class="headerlink" href="#set" title="Permalink to this headline">¶</a></h2>
<dl class="attribute">
<dt id="riak.datatypes.Set.value">
<code class="descclassname">Set.</code><code class="descname">value</code><a class="headerlink" href="#riak.datatypes.Set.value" title="Permalink to this definition">¶</a></dt>
<dd><p>An immutable copy of the current value of the set.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">frozenset</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="map">
<h2>Map<a class="headerlink" href="#map" title="Permalink to this headline">¶</a></h2>
<dl class="attribute">
<dt id="riak.datatypes.Map.counters">
<code class="descclassname">Map.</code><code class="descname">counters</code><a class="headerlink" href="#riak.datatypes.Map.counters" title="Permalink to this definition">¶</a></dt>
<dd><p>Filters keys in the map to only those of counter types. Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">map</span><span class="o">.</span><span class="n">counters</span><span class="p">[</span><span class="s1">&#39;views&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">increment</span><span class="p">()</span>
<span class="k">del</span> <span class="nb">map</span><span class="o">.</span><span class="n">counters</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="riak.datatypes.Map.flags">
<code class="descclassname">Map.</code><code class="descname">flags</code><a class="headerlink" href="#riak.datatypes.Map.flags" title="Permalink to this definition">¶</a></dt>
<dd><p>Filters keys in the map to only those of flag types. Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">map</span><span class="o">.</span><span class="n">flags</span><span class="p">[</span><span class="s1">&#39;confirmed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
<span class="k">del</span> <span class="nb">map</span><span class="o">.</span><span class="n">flags</span><span class="p">[</span><span class="s1">&#39;attending&#39;</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="riak.datatypes.Map.maps">
<code class="descclassname">Map.</code><code class="descname">maps</code><a class="headerlink" href="#riak.datatypes.Map.maps" title="Permalink to this definition">¶</a></dt>
<dd><p>Filters keys in the map to only those of map types. Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">map</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="s1">&#39;emails&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s1">&#39;home&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;user@example.com&quot;</span><span class="p">)</span>
<span class="k">del</span> <span class="nb">map</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="s1">&#39;spam&#39;</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="riak.datatypes.Map.registers">
<code class="descclassname">Map.</code><code class="descname">registers</code><a class="headerlink" href="#riak.datatypes.Map.registers" title="Permalink to this definition">¶</a></dt>
<dd><p>Filters keys in the map to only those of register types. Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">map</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="s2">&quot;riak-user&quot;</span><span class="p">)</span>
<span class="k">del</span> <span class="nb">map</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s1">&#39;access_key&#39;</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="riak.datatypes.Map.sets">
<code class="descclassname">Map.</code><code class="descname">sets</code><a class="headerlink" href="#riak.datatypes.Map.sets" title="Permalink to this definition">¶</a></dt>
<dd><p>Filters keys in the map to only those of set types. Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">map</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s1">&#39;friends&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;brett&quot;</span><span class="p">)</span>
<span class="k">del</span> <span class="nb">map</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s1">&#39;favorites&#39;</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="map-only-datatypes">
<h2>Map-only datatypes<a class="headerlink" href="#map-only-datatypes" title="Permalink to this headline">¶</a></h2>
<p>Two of the new Data Types may only be embedded in
<code class="xref py py-class docutils literal"><span class="pre">Map</span></code> objects (in addition to
<code class="xref py py-class docutils literal"><span class="pre">Map</span></code> itself):</p>
</div>
<div class="section" id="register">
<h2>Register<a class="headerlink" href="#register" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="flag">
<h2>Flag<a class="headerlink" href="#flag" title="Permalink to this headline">¶</a></h2>
<dl class="attribute">
<dt id="riak.datatypes.Flag.value">
<code class="descclassname">Flag.</code><code class="descname">value</code><a class="headerlink" href="#riak.datatypes.Flag.value" title="Permalink to this definition">¶</a></dt>
<dd><p>The current value of the flag.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">bool, None</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="query.html" class="btn btn-neutral float-right" title="Query Methods" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="object.html" class="btn btn-neutral" title="Values &amp; Objects" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2010-2014, Basho Technologies.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.7.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>